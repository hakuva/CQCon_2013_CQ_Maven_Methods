<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>CQCon: CQ Maven Methods</title>
		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">	
		<!--Add support for earlier versions of Internet Explorer -->
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<!-- Wrap the entire slide show in a div using the "reveal" class. -->
		<div class="reveal">
			<!-- Wrap all slides in a single "slides" class -->
			<div class="slides">

			<!-- INTRODUCTION -->
			<section>
				<h1>CQ Maven Methods</h1>
				<h2>CQCon 2013</h2>
			</section>

			<section>
				<section>
					<h2>Hello World</h2>
					<p>I'm Andrew.</p>
					<p><a href="mailto:asavory@adobe.com">asavory@adobe.com</a></p>
					<p><a href="http://twitter.com/savs">@savs</a>
					<p><a href="http://www.planetcq.org/">http://www.planetcq.org/</a></p>
					<aside class="notes">
						Please email me if you'd like to be added to planet cq.
					</aside>
				</section>

				<section>
					<p>Joined Adobe in November 2012</p>
				</section>

				<section>
					<p>CQ Newbie</p>
				</section>

				<section>
					<p>Background in Open Source, Content Management, Mobile</p>
				</section>

				<section>
					<p>Talking today about what I learned so far...<br /></p>
					<aside class="notes">
						It's likely I haven't learnt everything ... so ...
					</aside>
				</section>
				<section>
					<h2>Fork me!</h2>
					<p>If you found this talk useful, or spotted mistakes:<br />
					<a href="https://github.com/savs/CQCon_2013_CQ_Maven_Methods">github.com/savs/CQCon_2013_CQ_Maven_Methods</a></p>
				</section>

			</section>

			<!-- DEFINE THE PROBLEM -->
			<section>
				<section>

					<h2>Let's build a CQ site</h2>

					<p class="fragment">... uh, where to begin?</p>
				</section>
				<section>
					<h3>Method 1</h3>

					<p>Enthusiastically rush in, use <em>CRXDE Lite</em></p>
				</section>
				<section>
					<h3>Method 2</h3>

					<p>I'm a guru, I use <em>Eclipse</em> and <em>CRXDE</em></p>
				</section>
				<section>
					<h3>Method 3</h3>
					<p><strong>I'm</strong> a ninja, I use <em>emacs</em> and <em>vlt</em></p>
				</section>
				<section>
					<h3>Method 4</h3>
					<p><strong><em>I'm</em></strong> a guru ninja, I use <em>vi</em> and <em>curl</em></p>
				</section>
				<section>
					<h3>Method 5</h3>
					<p><em>Insert magnetising a hard disk joke</em></p>
				</section>
				<section>
					<h3>But what about ...</h3>
					<p class="fragment">reproducible builds?</p>
					<p class="fragment">using revision control?</p>
					<p class="fragment">collaborating with others?</p>
					<p class="fragment">deploying to production?</p>
					<aside class="notes">
					</aside>
				</section>
			</section>

			<!-- PROBLEM IN MORE DETAIL -->
			<section>
				<section>
					<h2>Why isn't it easier to build a CQ site?</h2>
					<p class="fragment highlight-red">Laborious project inception</p>
					<p class="fragment highlight-red">No two projects alike</p>
					<p class="fragment highlight-red">Don't know project layout</p>
					<p class="fragment highlight-red">Don't know project dependencies</p>
					<p class="fragment highlight-red">Hard for others to reproduce</p>
					<p class="fragment highlight-red">Hard to test</p>
					<p class="fragment highlight-red">Lengthy RTFM or worse (no FM)</p>
					<p class="fragment highlight-red">Documentation over convention</p>
				</section>
				<section>
					<h2>CQ SUCKS</h2>
				</section>
				<section>
					<h2>$PRODUCT SUCKS</h2>
				</section>
				<section>
					<h2>YOUR METHODOLOGY SUCKS</h2>
				</section>
			</section>

			<!-- DEFINE THE SOLUTION -->
			<section>
				<section>
					<h2>So how do we fix this?</h2>
					<p class="fragment">Maven</p>
					<p class="fragment">Git<br /><small>(or Subversion, or CVS ... ymmv)</small></p>
					<p class="fragment">Best Practices</p>
				</section>
				<section>
					<h2>Maven</h2>
					<blockquote cite="http://maven.apache.org/">
						&ldquo;Maven is a software project management and comprehension tool. Based on the concept of a project object model (POM), Maven can manage a project's build, reporting and documentation from a central piece of information.&rdquo;
					</blockquote>
				</section>
				<section>
					<h2>Git</h2>
					<blockquote cite="http://git-scm.org/">
						&ldquo;Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.
						&rdquo;
					</blockquote>
					<blockquote class="fragment"><em><small>Version control is a system that records changes to a file or set of files over time so that you can recall specific versions later.</small></em></blockquote>
				</section>
				<section>
					<h2>Best Practices</h2>
					<blockquote cite="http://en.wikipedia.org/wiki/Best_practice">
						&ldquo;A best practice is a method or technique that has consistently shown results superior to those achieved with other means.&rdquo;</blockquote>
					<blockquote class="fragment highlight-green"><small>In addition, a "best" practice can <strong>evolve</strong> to become better as improvements are discovered.</small></blockquote>
				</section>
				<section>
					<h2>What do we want?</h2>
					<p class="fragment">Minimal customisation</p>
					<p class="fragment">Standardised way to <em>create</em> a project</p>
					<p class="fragment">Standardised way to <em>build</em> a project</p>
					<p class="fragment">Standardised way to <em>deploy</em> a project</p>
					<p class="fragment">Standardised way to <em>test</em> a project</p>
					<p class="fragment">Standardised way to <em>share</em> a project</p>
				</section>
				<section>
					<p>Success criteria:</p>
					<h2>It's EASY to build a CQ site!</h2>
				</section>
			</section>

			<!-- GETTIING STARTED -->
			<section>
				<section>
					<h2>Getting started</h2>
					<p>Install Maven: http://maven.apache.org/guides/getting-started/</p>
					<p>Install Git: http://git-scm.com/book/en/Getting-Started-Installing-Git</p>
				</section>
				<section>
					<h2>Configuring Maven</h2>
					<ul>
						<li>Maven has a settings file that defines things like repositories where plugins can be downloaded (typically <code>~/.m2/settings.xml</code>).</li>
						<li>We need to add a <em>profile</em> to point to the Adobe repository.</li>
						<li>We then specify this repository when we use the archetype plugin.</li>
					</ul>
					<p><br /><small>See also: <a href="http://dev.day.com/docs/en/cq/current/core/how_to/how_to_use_the_vlttool/vlt-mavenplugin.html#Obtaining the Content Package Maven Plugin">Obtaining the Content Package Maven Plugin</a></small></p>
				</section>
				<section>
					<h2>Configuring Maven</h2>
<pre><small><code data-trim contenteditable>
&lt;profile&gt;
 &lt;id&gt;adobe-public&lt;/id&gt;
    &lt;activation&gt;
         &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    &lt;properties&gt;
         &lt;releaseRepository-Id&gt;adobe-public-releases&lt;/releaseRepository-Id&gt;
         &lt;releaseRepository-Name&gt;Adobe Public Releases&lt;/releaseRepository-Name&gt;
         &lt;releaseRepository-URL&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/releaseRepository-URL&gt;
    &lt;/properties&gt;
    &lt;repositories&gt;
         &lt;repository&gt;
             &lt;id&gt;adobe-public-releases&lt;/id&gt;
             &lt;name&gt;Adobe Basel Public Repository&lt;/name&gt;
             &lt;url&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/url&gt;
             &lt;releases&gt;
                 &lt;enabled&gt;true&lt;/enabled&gt;
                 &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
             &lt;/releases&gt;
             &lt;snapshots&gt;
                 &lt;enabled&gt;false&lt;/enabled&gt;
             &lt;/snapshots&gt;
         &lt;/repository&gt;
     &lt;/repositories&gt;
     &lt;pluginRepositories&gt;
         &lt;pluginRepository&gt;
             &lt;id&gt;adobe-public-releases&lt;/id&gt;
             &lt;name&gt;Adobe Basel Public Repository&lt;/name&gt;
             &lt;url&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/url&gt;
             &lt;releases&gt;
                 &lt;enabled&gt;true&lt;/enabled&gt;
                 &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
             &lt;/releases&gt;
             &lt;snapshots&gt;
                 &lt;enabled&gt;false&lt;/enabled&gt;
             &lt;/snapshots&gt;
         &lt;/pluginRepository&gt;
     &lt;/pluginRepositories&gt;
&lt;/profile&gt;
</code></small></pre>
				</section>
				<section>
					<h2>Configuring Maven</h2>
					<p>Enable the repository:</p>
<pre><code data-trim contenteditable>
&lt;activeProfiles&gt;
    &lt;activeProfile&gt;adobe-public&lt;/activeProfile&gt;
&lt;/activeProfiles&gt;
</code></pre>
				</section>
			</section>

			<!-- MAVEN DETAILS -->
			<section>
				<section>
					<h2>Building from Scratch</h2>
				</section>
				<section>
					<img border="0" width="800" src="images/inception-3403.jpg" alt="Inception"/>
				</section>
				<section>
					<h2>Archetypes</h2>
					<p><strong>archetype</strong> |ˈɑːkɪtʌɪp|<br />
						<small>noun</small><br />
						a very typical example of a certain person or thing: <em>he was the archetype of the old-style football club chairman.</em><br />
						• an original which has been imitated; a prototype: <em>an instrument which was the archetype of the early flute.</em></p>
				</section>
				<section>
					<h2>Maven Archetypes</h2>
					<p>A prototype upon which others are copied, patterned, or emulated.</p>
				</section>
				<section>
					<h2>What CQ archetypes are there?</h2>
					<p>Some common Maven archetypes for CQ include:</p>
					<ul>
						<li>Adobe Simple content package</li>
						<li>Adobe Simple content package with 3rd-party artifacts</li>
						<li>Adobe Multi-module application with classes and tests</li>
						<li>CQ Blueprints project multi-module</li>
					</ul>
				</section>
				<section>
					<h2>How to use an archetype</h2>
					<p>General format of the maven archetype command is:</p>
<pre><code>
mvn archetype:generate
	-DarchetypeGroupId=foo
	-DarchetypeArtifactId=bar
	-DarchetypeVersion=1.0.0
	-DarchetypeRepository=baz
</code></pre>
					<p><br /><small>See also: <a href="http://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven: Introduction to Archetypes</a></small></p>
				</section>

				<section>
					<h2>Archetypes Arguments</h2>
<pre><code>
mvn archetype:generate
	-DarchetypeGroupId=foo
	-DarchetypeArtifactId=bar
	-DarchetypeVersion=1.0.0
	-DarchetypeRepository=baz
</code></pre>

					<ul>
						<li><strong>archetypeGroupId</strong>: identifies the archetype project uniquely across all projects</li>
						<li><strong>archetypeArtifactId</strong>: the name of the archetype jar without a version number</li>
						<li><strong>archetypeRepository</strong>: where to get the archetype from (based on pluginRepository in settings.xml)</li>
					</ul>
					<p><br /><small>See also: <a href="http://maven.apache.org/guides/mini/guide-naming-conventions.html">Maven: Naming conventions</a></small></p>
				</section>

				<section>
					<h2>Simple content package Archetype</h2>
					<p>From the fine manual:</p>
					<blockquote>&ldquo;Creates a maven project that is suitable for installing resources for a simple CQ application. The folder structure is that used below the /apps folder of the CQ repository. The POM defines commands for packaging the resources that you place in the folders and installing the packages on the CQ server.&rdquo;</blockquote>
				</section>

				<section>
					<h2>Using the Simple content package Archetype</h2>
<pre><code>
mvn archetype:generate
	-DarchetypeGroupId=com.day.jcr.vault
	-DarchetypeArtifactId=simple-content-package-archetype
	-DarchetypeVersion=1.0.1
	-DarchetypeRepository=adobe-public-releases
</code></pre>
				</section>

				<section>
					<h2>Simple content package Arguments</h2>
					<ul>
						<li><strong>archetypeGroupId</strong>: <span class="fragment highlight-green">com.day.jcr.vault</span><br />identifies the archetype project uniquely across all projects</li>
						<li><strong>archetypeArtifactId</strong>: <span class="fragment highlight-green">simple-content-package-archetype</span><br />the name of the archetype jar without a version number</li>
						<li><strong>archetypeRepository</strong>: <span class="fragment highlight-green">adobe-public-releases</span><br />where to get the archetype from (based on pluginRepository in settings.xml)</li>
					</ul>
				</section>

				<section>
					<h2>Simple content package in action</h2>
					<video data-autoplay src="http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"></video>
					<!-- FIXME insert video -->
				</section>
				<section>
					<h2>Simple content package configuration</h2>
					<ul>
						<li>groupId: Like a package name, e.g. com.yourcompany.myproject</li>
						<li>artifactId: name of the jar without the version, e.g. myproject</li>
						<li>version: accept the default</li>
						<li>package: not used in simple-content-package FIXME</li>
						<li>appsFolderName: name of /apps/myproject, e.g. myproject</li>
						<li>artifactName: FIXME</li>
						<li>packageGroup: FIXME sidekick?</li>
					</ul>
					<p><br /><small>See also: <a href="http://maven.apache.org/guides/mini/guide-naming-conventions.html">Maven: Naming conventions</a></small></p>
				</section>

				<section>
					<h2>Simple content package output</h2>
<pre>
${artifactId}
   |- pom.xml
   |- README.txt
   |- src
      |- main
         |- content
             |- jcr_root
                 |- apps
                     |- ${appsFolderName}
                            |- components 
                               |- .content.xml
                            |- config
                            |- install
             |- META-INF
                 |- vault
                     |- config.xml
                     |- filter.xml
                     |- nodetypes.cnd
                     |- properties.xml
                     |- definition
                        |- .content.xml
</pre>
				</section>
				<section>
					<h2>Simple content package output</h2>
					<!-- FIXME: more detail, or skip? -->
					<ul>
						<li>POM file</li>
							<ul>
								<li>Instructions for compiling, creating bundles, deploying to CQ in packages</li>
							</ul>
						<li>FileVault configuration files</li>
					</ul>
				</section>
				<section>
					<h2>Working with your project</h2>
					<p>What now?</p>
					<ul>
						<li>Build a content package: <code>mvn install</code></li>
						<li>Build and deploy: <code>mvn -PautoInstallPackage install</code></li>
					</ul>
					<aside class="notes">
						<p>BUT we're not going to do this ... yet.<br/>
						We've got the project, before we break it, let's save it.</p>
					</aside>
				</section>
			</section>



			<!-- GIT DETAILS -->
			<section>
				<section>
					<h2>Why Git?</h2>
					<ul>
						<li>Local safety net</li>
						<li>"The internet is my backup"</li>
						<li>It's good to share</li>
						<li>Enlightened self-interest</li>
					</ul>
				</section>
				<section>
					<h2>Git project setup</h2>
<pre><code>
cd projectname
git init
</code></pre>
				</section>
				<section>
					<h2>Git Ignore</h2>
					<p>Edit <code>.gitignore</code>, for example:</p>
<pre><code data-trim contenteditable>
.classpath
.project
.vlt/
.settings/
target/
</code></pre>
				</section>
				<section>
					<h2>Get it in Git</h2>
<pre><code>
git add *
git commit -m 'Initial project version'
</code></pre>
				</section>
				<section>
					<h2>Get it in Github (optional)</h2>
					<ul>
						<li>Create a project on github</li>
						<li><code>git remote add origin git@github.com:YOURUSERNAME/YOURPROJECTNAME.git</code></li>
						<li><code>git pull origin master</code></li>
						<li><code>git push origin master</code></li>
					</ul>
					<p><br /><small>See also: <a href="http://github.com/">github</a></small></p>
				</section>
				<section>
					<h2>Install project</h2>
				</section>
				<section>
					<h2>Commit project</h2>
				</section>
				<section>
					<h2>Test project</h2>
					<p>For guru ninjas and people that don't like being bugged by their colleagues.</p>
					<p>Prove it works on different platform. From scratch.</p>
				</section>
			</section>

			<!-- BASIC EXAMPLE END-TO-END -->
			<section>
				<h2>Putting it all together</h2>
			</section>

<!--
			<section data-markdown="talk.md" data-separator="^\n\n\n" data-vertical="^\n\n"></section>
-->
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>
			// Required, even if empty.
			Reveal.initialize({
				// Display controls in the bottom right corner
				controls: true,
				// Display a presentation progress bar
				progress: true,

				// Optional libraries used to extend on reveal.js
				dependencies: [
					// Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },

					// Interpret Markdown in <section> elements
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

					// Syntax highlight for <code> elements
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

					// Zoom in and out with Alt+click
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

					// Speaker notes
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

				]

			});
		</script>
	</body>
</html>