<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>CQCon: CQ Maven Methods</title>
		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">	
		<!--Add support for earlier versions of Internet Explorer -->
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
		<style type="text/css">
			.maven .reveal .state-background {
				background: rgba( 179, 234, 245, 0.6 );
			}
/* page numbers https://github.com/hakimel/reveal.js/pull/56 */

.reveal .controls div.slide-number {
    width: 25px;
    left: 27px;
    top: 33px;
    text-align: center;
    vertical-align: middle;
    font-size: .5em;
    font-weight: bold;
    opacity: .5;
   }
  
		</style>
	</head>

	<body>
		<!-- Wrap the entire slide show in a div using the "reveal" class. -->
		<div class="reveal">
			<!-- Wrap all slides in a single "slides" class -->
			<div class="slides">

			<!-- INTRODUCTION -->
			<section>
				<h1>CQ Maven Methods</h1>
				<h2>CQCon 2013</h2>
			</section>

			<section>
				<section>
					<h2>Hello World</h2>
					<p>I'm Andrew.</p>
					<p><a href="mailto:asavory@adobe.com">asavory@adobe.com</a></p>
					<p><a href="http://twitter.com/savs">@savs</a>
				</section>

				<section>
					<p>Joined Adobe in November 2012</p>
				</section>

				<section>
					<p>CQ Newbie</p>
					<p class="fragment">JCR/CMS/TLA old hat</p>
				</section>

				<section>
					<p>Background in Open Source, Content Management, Mobile</p>
				</section>

				<section>
					<p>Talking today about what I learned so far...<br /></p>
					<aside class="notes">
						It's likely I haven't learnt everything ... so ...
					</aside>
				</section>

				<section>
					<h2>Fork me!</h2>
					<p>If you found this talk useful, or spotted mistakes:<br />
					<a href="https://github.com/savs/CQCon_2013_CQ_Maven_Methods">github.com/savs/CQCon_2013_CQ_Maven_Methods</a></p>
				</section>

				<section>
					<h2>In your browser</h2>
					<p><small><a href="http://www.andrewsavory.com/presentations/CQCon_2013_CQ_Maven_Methods/index.html">http://andrewsavory.com/presentations/CQCon_2013_CQ_Maven_Methods/index.html</a></small></p>
				</section>

				<section>
					<h2>See also</h2>
					<p><a href="http://www.planetcq.org/">http://www.planetcq.org/</a></p>
					<aside class="notes">
						Please email me if you'd like to be added to planet cq.
					</aside>
				</section>

			</section>

			<!-- Getting to know the audience -->
			<section>
				<section>
					<img style="border: none" width="50%" src="images/group.svg" alt="audience"/>
					<aside class="notes">
						How about the audience? Tell me about yourselves...
					</aside>
				</section>
				<section>
					<img style="border: none" width="50%" src="images/question bubble.svg" "questions"/>
					<aside class="notes">
						How many of you have heard of Maven?
						How many of you have used Maven?
						How many of you have used version control?
						How many of you have used git?
						How many of you use Maven and version control on your CQ projects?
					</aside>
				</section>
			</section>

			<!-- DEFINE THE PROBLEM -->
			<section>
				<section>

					<h2>Let's build a CQ site</h2>
					<p class="fragment"><img style="border: none" width="30%" src="images/question mark.svg" alt="question mark"/><br />
					... uh, where to begin?
					</p>
				</section>
				<section>
					<h3>Method 1</h3>

					<p>Enthusiastically rush in, use <em>CRXDE Lite</em></p>
				</section>
				<section>
					<h3>Method 2</h3>

					<p>I'm a guru, I use <em>Eclipse</em> and <em>CRXDE</em></p>
				</section>
				<section>
					<h3>Method 3</h3>
					<p><strong>I'm</strong> a ninja, I use <em>emacs</em> and <em>vlt</em></p>
				</section>
				<section>
					<h3>Method 4</h3>
					<p><strong><em>I'm</em></strong> a guru ninja, I use <em>vi</em> and <em>curl</em></p>
				</section>
				<section>
					<h3>Method 5</h3>
					<p class="fragment">
					<img style="border: none" width="30%" src="images/magnet.svg" alt="magnet"/>
					<img style="border: none" width="30%" src="images/hard disk.svg" alt="hard disk"/></p>
					<p class="fragment"><br /><small>See also: <a href="http://xkcd.com/378/">http://xkcd.com/378/ – Real Programmers</a></small></p>
					<aside class="notes">
						Real programmers program by waving magnets over hard disks to realign the magnetic flux patterns on the platters.
					</aside>
				</section>
				<section>
					<h3>But what about ...</h3>
					<p class="fragment">reverting mistakes?</p>
					<p class="fragment">reproducible builds?</p>
					<p class="fragment">collaborating with others?</p>
					<p class="fragment">deploying to production?</p>
					<aside class="notes">
						Each of these approaches works to some degree, but don't necessarily lead to a sustainable development environment.
					</aside>
				</section>
			</section>

			<!-- PROBLEM IN MORE DETAIL -->
			<section data-state="alert">
				<section>
					<h2>Why isn't it easier to build a CQ site?</h2>
					<p>Laborious project inception</p>
					<p>No two projects alike</p>
					<p>Don't know project layout</p>
					<p>Don't know project dependencies</p>
					<p>Hard for others to reproduce</p>
					<p>Hard to test</p>
					<p>Lengthy RTFM or worse (no FM)</p>
					<p>Documentation over convention</p>
				</section>
				<section>
					<h2>CQ SUCKS</h2>
				</section>
				<section>
					<h2>$PRODUCT SUCKS</h2>
				</section>
				<section>
					<h2>YOUR METHODOLOGY SUCKS</h2>
					<p>(sorry)</p>
				</section>
			</section>

			<!-- DEFINE THE SOLUTION -->
			<section data-state="soothe">
				<section>
					<h2>So how do we fix this?</h2>
					<p class="fragment">Maven</p>
					<p class="fragment">Git<br /><small>(or Subversion, or CVS ... ymmv)</small></p>
					<p class="fragment">Best Practices</p>
				</section>
				<section>
					<h2>Maven</h2>
					<blockquote cite="http://maven.apache.org/">
						&ldquo;Maven is a software project management and comprehension tool. Based on the concept of a project object model (POM), Maven can manage a project's build, reporting and documentation from a central piece of information.&rdquo;
					</blockquote>
				</section>
				<section>
					<h2>Git</h2>
					<blockquote cite="http://git-scm.org/">
						&ldquo;Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.
						&rdquo;
					</blockquote>
					<blockquote class="fragment"><em><small>Version control is a system that records changes to a file or set of files over time so that you can recall specific versions later.</small></em></blockquote>
				</section>
				<section>
					<h2>Best Practices</h2>
					<blockquote cite="http://en.wikipedia.org/wiki/Best_practice">
						&ldquo;A best practice is a method or technique that has consistently shown results superior to those achieved with other means.&rdquo;</blockquote>
					<blockquote class="fragment highlight-green"><small>In addition, a "best" practice can <strong>evolve</strong> to become better as improvements are discovered.</small></blockquote>
				</section>
				<section>
					<h2>What do we want?</h2>
					<p class="fragment">Minimal customisation</p>
					<p class="fragment">Standardised way to <em>create</em> a project</p>
					<p class="fragment">Standardised way to <em>build</em> a project</p>
					<p class="fragment">Standardised way to <em>deploy</em> a project</p>
					<p class="fragment">Standardised way to <em>test</em> a project</p>
					<p class="fragment">Standardised way to <em>share</em> a project</p>
				</section>
				<section>
					<h2>Our target</h2>
					<img style="border: none" src="images/flow_default.png" alt="Default flow" />
				</section>
				<section>
					<p>Success criteria:</p>
					<h2>It's EASY to build a CQ site!</h2>
				</section>
			</section>

			<!-- GETTIING STARTED -->
			<section data-state="soothe">
				<section>
					<h2>Getting started</h2>
					<p>Install Maven: http://maven.apache.org/guides/getting-started/</p>
					<p>Install Git: http://git-scm.com/book/en/Getting-Started-Installing-Git</p>
				</section>
				<section>
					<h2>Configuring Maven</h2>
					<ul>
						<li>Maven has a settings file that defines things like repositories where plugins can be downloaded (typically <code>~/.m2/settings.xml</code>).</li>
						<li>We need to add a <em>profile</em> to point to the Adobe repository.</li>
						<li>We then specify this repository when we use the archetype plugin.</li>
					</ul>
					<p><br /><small>See also: <a href="http://dev.day.com/docs/en/cq/current/core/how_to/how_to_use_the_vlttool/vlt-mavenplugin.html#Obtaining the Content Package Maven Plugin">Obtaining the Content Package Maven Plugin</a></small></p>
				</section>
				<section>
					<h2>Configuring Maven</h2>
<pre><small><code>&lt;profile&gt;
    &lt;id&gt;adobe-public&lt;/id&gt;
    &lt;activation&gt;
         &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    &lt;properties&gt;
         &lt;releaseRepository-Id&gt;adobe-public-releases&lt;/releaseRepository-Id&gt;
         &lt;releaseRepository-Name&gt;Adobe Public Releases&lt;/releaseRepository-Name&gt;
         &lt;releaseRepository-URL&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/releaseRepository-URL&gt;
    &lt;/properties&gt;
    &lt;repositories&gt;
         &lt;repository&gt;
             &lt;id&gt;adobe-public-releases&lt;/id&gt;
             &lt;name&gt;Adobe Basel Public Repository&lt;/name&gt;
             &lt;url&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/url&gt;
             &lt;releases&gt;
                 &lt;enabled&gt;true&lt;/enabled&gt;
                 &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
             &lt;/releases&gt;
             &lt;snapshots&gt;
                 &lt;enabled&gt;false&lt;/enabled&gt;
             &lt;/snapshots&gt;
         &lt;/repository&gt;
     &lt;/repositories&gt;
     &lt;pluginRepositories&gt;
         &lt;pluginRepository&gt;
             &lt;id&gt;adobe-public-releases&lt;/id&gt;
             &lt;name&gt;Adobe Basel Public Repository&lt;/name&gt;
             &lt;url&gt;http://repo.adobe.com/nexus/content/groups/public&lt;/url&gt;
             &lt;releases&gt;
                 &lt;enabled&gt;true&lt;/enabled&gt;
                 &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
             &lt;/releases&gt;
             &lt;snapshots&gt;
                 &lt;enabled&gt;false&lt;/enabled&gt;
             &lt;/snapshots&gt;
         &lt;/pluginRepository&gt;
     &lt;/pluginRepositories&gt;
&lt;/profile&gt;
</code></small></pre>
				</section>
				<section>
					<h2>Configuring Maven</h2>
					<p>Enable the repository:</p>
<pre>&lt;activeProfiles&gt;
    &lt;activeProfile&gt;adobe-public&lt;/activeProfile&gt;
&lt;/activeProfiles&gt;
</pre>
<p>Or use the <code>-P</code> option to activate profile(s):</p>
<pre>mvn -P adobe-public [...]</pre>
				</section>
			</section>

			<!-- MAVEN DETAILS -->
			<section data-state="maven">
				<section>
					<h2>Using Maven</h2>
				</section>

				<section>
					<h2>Starting a new project ...</h2>
					<span class="fragment">
						<img style="border: none" width="30%" src="images/lightbulb.svg" alt="lightbulb"/>
						<img style="border: none" width="30%" src="images/wheel.svg" alt="wheel"/>
					</span>
					<p class="fragment">... can sometimes feel like reinventing the wheel.</p>
				</section>
				<section>
					<h2>You are here</h2>
					<img style="border: none" src="images/flow_archetype.png" alt="Flow at archetype" />
				</section>
				<section>
					<h2>Archetypes</h2>
					<p><strong>archetype</strong> |ˈɑːkɪtʌɪp|<br />
						<small>noun</small></p>
					<ul>
						<li>a very typical example of a certain person or thing: <em>he was the archetype of the old-style football club chairman.</em></li>
						<li>an original which has been imitated; a prototype: <em>an instrument which was the archetype of the early flute.</em></li>
					</ul>
				</section>
				<section>
					<h2>Maven Archetypes</h2>
					<blockquote>A prototype upon which others are<br />copied, patterned, or emulated.</blockquote>
				</section>
				<section>
					<h2>What CQ archetypes are there?</h2>
					<ul>
						<li class="fragment highlight-green"><em>simple-content-package</em></li>
						<ul>
							<li>Generates a simple <a href="http://dev.day.com/docs/en/cq/current/administering/package_manager.html">content package</a></li>
						</ul>
						<li class="fragment highlight-green"><em>multimodule-content-package</em></li>
						<ul>
							<li>Includes the folder structure for developing a CQ application (content package and bundle).</li>
						</ul>
						<li class="fragment highlight-green"><em>cqblueprints multi-module</em></li>
						<ul>
							<li>Third-party archetype encapsulating best practices for working with e.g. OSGi bundles, taglibs, and CQ content</li>
						</ul>
					</ul>
					<p><br /><small>See also: <a href="http://dev.day.com/docs/en/cq/current/administering/package_manager.html">How to work with packages</a></small></p>
					<aside class="notes">
						<ul>
							<li>Each archetype name is highlighted in turn</li>
						</ul>
					</aside>
				</section>
				<section>
					<h2>On Packages</h2>
					<ul>
						<li>Packages enable the importing and exporting of repository content. They are used to install new functionality, transfer content between instances, or back up the repository</li>
						<li>A package is a zip file in file system (vault) serialization format</li>
						<li>Packages include meta information - filter definitions, import configuration, package properties</li>
						<li>Packages are often managed through the CQ <a href="http://localhost:4502/crx/packmgr/index.jsp">Package Manager</a></li>
					</ul>
				</section>
				<section>
					<h2>On Bundles</h2>
					<ul>
						<li>Bundles are modular containers of functionality for OSGi – essentially a java module that contains application logic</li>
						<li>Bundles consist of java classes and other resources needed to deliver functionality or to provide services to other bundles.</li>
						<li>Bundles can be managed through the CQ <a href="http://localhost:4502/system/console/bundles">Web Console</a></li>
					</ul>
					<p><br /><small>See also: <a href="http://helpx.adobe.com/adobe-cq/using/creating-osgi-bundles-digital-marketing.html">Creating OSGi bundles using CRXDE</a></small></p>
				</section>
				<section>
					<h2>How to use an archetype</h2>
<pre><code>mvn archetype:generate
	-DarchetypeGroupId=foo
	-DarchetypeArtifactId=bar
	-DarchetypeVersion=1.0.0
	-DarchetypeRepository=baz
</code></pre>
					<ul>
						<li><strong>archetypeGroupId</strong>: identifies the archetype project uniquely across all projects</li>
						<li><strong>archetypeArtifactId</strong>: the name of the archetype jar without a version number</li>
						<li><strong>archetypeRepository</strong>: where to get the archetype from (based on pluginRepository in settings.xml)</li>
					</ul>

					<p><br /><small>See also: <a href="http://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven: Introduction to Archetypes</a> and <a href="http://maven.apache.org/guides/mini/guide-naming-conventions.html">Maven: Naming conventions</a></small></p>
				</section>

				<section>
					<h2>Simple content package Archetype</h2>
					<p>From the fine manual:</p>
					<blockquote>&ldquo;Creates a maven project that is suitable for installing resources for a simple CQ application. The folder structure is that used below the /apps folder of the CQ repository. The POM defines commands for packaging the resources that you place in the folders and installing the packages on the CQ server.&rdquo;</blockquote>
				</section>

				<section>
					<h2>Simple content package usage</h2>
<pre><code>mvn archetype:generate
	-DarchetypeGroupId=com.day.jcr.vault
	-DarchetypeArtifactId=simple-content-package-archetype
	-DarchetypeVersion=1.0.1
	-DarchetypeRepository=adobe-public-releases
</code></pre>
					<ul>
						<li><strong>archetypeGroupId</strong>: <span class="fragment highlight-green">com.day.jcr.vault</span><br />identifies the archetype project uniquely across all projects</li>
						<li><strong>archetypeArtifactId</strong>: <span class="fragment highlight-green">simple-content-package-archetype</span><br />the name of the archetype jar without a version number</li>
						<li><strong>archetypeRepository</strong>: <span class="fragment highlight-green">adobe-public-releases</span><br />where to get the archetype from (based on pluginRepository in settings.xml)</li>
					</ul>
				</section>

				<section>
					<h2>Simple content package in action</h2>
					<iframe width="853" height="480" src="http://www.youtube.com/embed/52UDO7thbvM?rel=0" frameborder="0" allowfullscreen></iframe>
				</section>
				<section>
					<h2>Simple content package parameters</h2>
					<ul>
						<li><strong>groupId</strong>: Like a package name, e.g. com.yourcompany.myproject</li>
						<li><strong>artifactId</strong>: name of the jar without the version, e.g. myproject</li>
						<li><strong>version</strong>: accept the default</li>
						<li><strong>package</strong>: not used in simple-content-package</li>
						<li><strong>appsFolderName</strong>: name of /apps/myproject, e.g. myproject</li>
						<li><strong>artifactName</strong>: Description in Package Manager</li>
						<li><strong>packageGroup</strong>: Group in Package Manager</li>
					</ul>
					<p><br /><small>See also: <a href="http://maven.apache.org/guides/mini/guide-naming-conventions.html">Maven: Naming conventions</a></small></p>
				</section>
				<section>
					<h2>Simple content package output</h2>
					<ul>
						<li>Template directories</li>
						<li><code>pom.xml</code> file</li>
							<ul>
								<li>Instructions for compiling, creating bundles, deploying to CQ in packages</li>
							</ul>
						<li>FileVault configuration files</li>
					</ul>
				</section>
				<section>
					<h2>Multimodule Content Package Usage</h2>
<pre><code>mvn archetype:generate
	-DarchetypeGroupId=com.day.jcr.vault
	-DarchetypeArtifactId=multimodule-content-package-archetype
	-DarchetypeVersion=1.0.1
	-DarchetypeRepository=adobe-public-releases
</code></pre>
				</section>

				<section>
					<h2>Multimodule content package output</h2>
<pre>${artifactId}
   |- pom.xml
   |- bundle
      |- pom.xml
      |- src
         |- main
            |- java
               |- ${groupId}
                  |- SimpleDSComponent.java
         |- test
            |- java
               |- ${groupId}
                  |- SimpleUnitTest.java
   |- content
      |- pom.xml
      |- src
         |- main
            |- content
               |- jcr_root
                  |- apps
                     |- ${appsFolderName} 
                            |- config
                            |- install
                  |- META-INF
                      |- vault
                         |- config.xml
                         |- filter.xml
                         |- nodetypes.cnd
                         |- properties.xml
                         |- definition
                            |- .content.xml
</pre>

				</section>


				<section>
					<h2>cqblueprints multi-module Usage</h2>
					<ul>
						<li>First add the CQ Blueprints Maven Repository to Maven's <code>settings.xml</code>, then:</li>
					</ul>
<pre>mvn -P cqblueprints archetype:generate
	-DarchetypeGroupId=com.cqblueprints.archetypes
	-DarchetypeArtifactId=multi-module
	-DarchetypeVersion=1.0.5
	-DarchetypeRepository=cqblueprints.plugins.releases
</pre>
					<ul>
						<li><strong>archetypeGroupID</strong>: <em>com.cqblueprints.archetypes</em></li>
						<li><strong>archetypeArtifactId</strong>: <em>multi-module</em></li>
						<li><strong>archetypeVersion</strong>: <em>1.0.5</em></li>
						<li><strong>archetypeRepository</strong>: <em>cqblueprints.plugins.releases</em></li>
					</ul>
					<p><br /><small>See also: <a href="http://cqblueprints.com/xwiki/bin/view/Blue+Prints/Connecting+to+the+CQ+Blueprints+Repository">Connecting to the CQ Blueprints Repository</a> and <a href="http://cqblueprints.com/xwiki/bin/view/Blue+Prints/The+CQ+Project+Maven+Archetype">The CQ Project Maven Archetype</a></small></p>
				</section>
				<section>
					<h2>cqblueprints multi-module output</h2>
<pre>${artifactId}
   |- README
   |- pom.xml
   |- ${artifactId}-all
      |- pom.xml
   |- ${artifactId}-config
   |- ${artifactId}-content
   |- ${artifactId}-services
   |- ${artifactId}-taglib
   |- ${artifactId}-view
</pre>
				</section>
				<section>
					<h2>Why use cqblueprints multi-module?</h2>

					<blockquote cite="http://www.headwire.com/">
						&ldquo;The things we wanted to consider with our archetype is to address concerns of larger teams&rdquo;
					</blockquote>
					<p>The cqblueprint multi-module archetype is developed by <a href="http://www.headwire.com/">headwire.com</a></p>
				</section>
				<section>
					<h2>CQBlueprints multimodule design</h2>
					<ul>
						<li><strong>foo-view</strong> subproject: <em>where css/html/js developers (frontend) do their work</em></li>
						<li><strong>foo-taglib foo-services</strong>: <em>where java developers (backend) do their work</em></li>
						<li><strong>foo-config</strong>: <em>where the configuration (runmode configs stored)</em></li>
						<li><strong>foo-content</strong>: <em>how we get initial content and site structure onto the developer's box quickly</em></li>
						<li><strong>foo-all</strong>: <em>how we hand off builds to the next environment</em></li>
					</ul>
				</section>
			</section>

			<!-- GIT DETAILS -->
			<section data-state="mint">
				<section>
					<h2>Using Git</h2>
				</section>
				<section>
					<h2>Why Git?</h2>
					<ul class="fragment">
						<li>Local safety net</li>
						<li>"The internet is my backup"</li>
						<li>It's good to share</li>
						<li>Enlightened self-interest</li>
					</ul>
				</section>
				<section>
					<h2>You are here</h2>
					<img style="border: none" src="images/flow_git.png" alt="Flow at git" />
				</section>
				<section>
					<h2>Git project setup</h2>
<pre>cd projectname
git init
</pre>
				</section>
				<section>
					<h2>Git Ignore</h2>
					<p>Edit <code>.gitignore</code>, for example:</p>
<pre>.classpath
.project
.vlt/
.settings/
target/
</pre>
				</section>
				<section>
					<h2>Get it in Git</h2>
<pre>git add *
git commit -m 'Initial project version'
</pre>
				</section>
				<section>
					<h2>Get it in Github (optional)</h2>
<pre>cd project
git <strong class="fragment highlight-red">hub-new-repo</strong>
</pre>
<p class="fragment"><code>hub-new-repo</code> is a shortcut for creating a repository on github and pushing your local repo into it</p>
<p><br /><small>See also: <a href="http://stackoverflow.com/a/16766133/1081791">CLI remote github repo creation</a></small></p>
<p><br /><small>See also: <a href="http://github.com/">github</a></small></p>
				</section>
				<section>
					<h3>... time passes ...</h3>
					<img style="border: none" width="30%" src="images/time.svg" alt="time"/>
				</section>
				<section>
					<h2>Commit project</h2>
					<ul>
						<li><code>git add <em>filenames</em></code></li>
						<li><code>git commit -m "<em>meaningful message</em>"</code></li>
						<li><code>git push origin master</code></li>
					</ul>
				</section>
			</section>

			<!-- Practical examples -->
			<section data-state="lila">
				<section>
					<h2>(BEST) PRACTICE(S)</h2>
				</section>
				<section>

					<blockquote cite="http://c2.com/cgi/wiki?LazinessImpatienceHubris">
						&ldquo;the three great virtues of a programmer: laziness, impatience, and hubris&rdquo;
					</blockquote>
				</section>

				<section>
					<h2>You are here</h2>
					<img style="border: none" src="images/flow_build_deploy.png" alt="Flow at build and deploy" />
				</section>

				<section>
					<img style="border: none" src="images/CMS_Borat_click_faster.png" alt="CMS Borat quote"/>
					<aside class="notes">
						If you're clicking the mouse you're doing it wrong.
					</aside>
				</section>

				<section>
					<h2>Building</h2>
					<img style="border: none" width="30%" src="images/build.svg" alt="build"/>
				</section>
				<section>
					<h2>How can we build smarter?</h2>

					<p>Create local zips and jars that you can upload: <br />
					<code>mvn package</code><br />
					produces:</p>
					<ul>
						<li><strong>Content package</strong> output: <code>target/yourapp-content-1.0-SNAPSHOT.zip</code></li>
						<li><strong>Bundle</strong> output: <code>target/testapp-bundle-1.0-SNAPSHOT.jar</code></li>
					</ul>
				</section>
				<section>
					<h2>Deploying</h2>
					<img style="border: none" width="30%" src="images/upload.svg" alt="upload"/>
				</section>
				<section>
					<h2>How can we build <em>and</em> deploy smarter?</h2>
					<ul>
						<li><strong>Content package</strong>: <code>mvn -PautoInstallPackage install</code></li>
						<li><strong>Bundle</strong>: <code>mvn -PautoInstallBundle install</code></li>
					</ul>
					<br />
					<p><br />cqblueprints: <code>mvn -Pauto-deploy install</code></p>
				</section>
				<section>
					<h2>Developing</h2>
					<img style="border: none" width="30%" src="images/2sync.svg" alt="sync"/>
				</section>
				<section>
					<h2>You are here</h2>
					<img style="border: none" src="images/flow_develop_sync.png" alt="Flow at developing and syncing" />
				</section>
				<section>
					<p><img style="border: none" width="30%" src="images/question mark.svg" alt="question mark"/><br />
					How do we <em>develop</em> in a world of maven builds and deploys and git saves?</p>
				</section>
				<section>
					<h2>The FileVault tool</h2>
					<p>You can use the FileVault tool (<code>vlt</code>) to check in, check out, update and sync local content with the repository.</p>
					<ul>
						<li>Install: extract <code>crx-quickstart/opt/filevault/filevault.[tgz|zip]</code> and add to your path</li>
						<li>Usage: <code>vlt --credentials admin:admin co --force http://localhost:4502/crx</code></li>
					</ul>
					<p><br /><small>See also: <a href="http://dev.day.com/docs/en/cq/current/core/how_to/how_to_use_the_vlttool.html">How to use the VLT Tool</a></small></p>
				</section>
				<section>
					<h2>Sample development workflow</h2>
					<ul>
						<li>Use maven to build and deploy</li>
						<li>Initialise <code>vlt</code></li>
						<li>Create components, templates with CRXDE Lite</li>
						<li>Use <code>vlt</code> to copy back into local filesystem</li>
						<li>Change locally</li>
						<li>Use <code>vlt</code> to copy back into the repository</li>
						<li>Add to git</li>
					</ul>
				</section>
				<section>
					<h2>Demo</h2>
				</section>
				<!--
				<section>
					<h2>Syncing</h2>
					<img style="border: none" width="30%" src="images/3sync.svg" alt="sync"/>
				</section>
				<section>
					<h2>Stay in sync</h2>
					<ul>
						<li>Go to the JCR root:<br /><code class="fragment highlight-green">cd content/src/main/content/jcr_root/</code></li>
						<li>Check out the repository:<br /><code class="fragment highlight-green">vlt --credentials admin:admin co --force http://localhost:4502/crx</code></li>
						<li>Install and automatically configure the vault sync service bundle:<br /><code class="fragment highlight-green">vlt --credentials admin:admin sync --uri http://localhost:4502/crx install</code></li>
						<li>Add the current folder to the sync configuration:<br /><code class="fragment highlight-green">vlt sync register</code></li>
					</ul>
				</section>
				<section>
					<h2>Three-way syncing</h2>
					<ul>
						<li>FileVault will keep the repository and filesystem in sync; you also need to keep the source control system in sync</li>
						<li>Edit <code>.vlt-sync-config.properties</code> and set <code>sync-once</code> to control definitive versions.</li>
						<li>Then use <code>git pull</code>, <code>git add</code>, and <code>git commit</code> to update with SCM</li>
					</ul>
				</section>
				<section data-state="alert">
					<img style="border: none" width="30%" src="images/warning.svg" alt="Warning"/>
					<p>The VLT Sync feature only supports simple files and folders but detects special vault serialized files (.content.xml, dialog.xml, etc) and ignores them silently. Thus it is possible to use vault sync on a default vlt checkout.</p>
				</section>
				-->
				<section>
					<h2>Testing</h2>
					<img style="border: none" width="30%" src="images/crash_test_dummy.svg" alt="crash test dummy"/>
					<aside class="notes">
						You have of course been writing tests during development.
						Testing is a huge topic, so not covering here.
						We'll only give a few pointers.
					</aside>
				</section>

				<section>
					<h2>Continuous Integration?</h2>
					<ul>
						<li><a href="http://jenkins-ci.org/">Jenkins</a> with <a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Git plugin</a>, <a href="https://wiki.jenkins-ci.org/display/JENKINS/Github+Plugin">GitHub plugin</a></li>
						<li><a href="http://www.seleniumhq.org/">Selenium</a> as a <a href="http://www.labelmedia.co.uk/blog/posts/setting-up-selenium-server-on-a-headless-jenkins-ci-build-machine.html">server</a></li>
						<li><a href="http://cukes.info/">Cucumber</a> <a href="https://github.com/cucumber/cucumber-jvm#readme">for java</a> with <a href="https://github.com/masterthought/jenkins-cucumber-jvm-reports-plugin-java#readme">Jenkins plugin</a> and <a href="http://aslakhellesoy.com/post/20006051268/cucumber-jvm-1-0-0">tests in java</a></li>
					</ul>
				</section>

				<section>
					<h2>Production</h2>
					<img style="border: none" width="30%" src="images/factory.svg" alt="production"/>
				</section>
				<section>
					<p><img style="border: none" width="30%" src="images/question mark.svg" alt="question mark"/><br />
					How do we <em>move to production</em> in a world of maven builds and deploys and git saves?</p>
				</section>
				<section>
					<h2>You are here</h2>
					<img style="border: none" src="images/flow_production.png" alt="Flow at production" />
				</section>
				<!-- FIXME test this -->
				<section>
<pre>
&lt;profile&gt;
    &lt;id&gt;auto-deploy-prod&lt;/id&gt;
        &lt;properties&gt;
        &lt;cq.host&gt;server&lt;/cq.host&gt;
        &lt;cq.port&gt;4502&lt;/cq.port&gt;
        &lt;cq.user&gt;admin&lt;/cq.user&gt;
        &lt;cq.password&gt;admin&lt;/cq.password&gt;
        &lt;/properties&gt;
&lt;/profile&gt;
</pre>
<pre>
	mvn -Pauto-deploy-prod install
</pre>
				</section>
				<section>
					<h2>Deployment profile</h2>
					<p>FIXME: need to find appropriate version for each archetype</p>
<pre>
&lt;profiles&gt;
    &lt;!-- profile for deployment to shared development instance --&gt;
    &lt;profile&gt;
        &lt;id&gt;devDeploy&lt;/id&gt;
        &lt;activation&gt;
        &lt;/activation&gt;
        &lt;properties&gt;
            &lt;depl.user&gt;&lt;!-- {shared instance user} --&gt;&lt;/depl.user&gt;
            &lt;depl.password&gt;&lt;!-- {shared instance password} --&gt;&lt;/depl.password&gt;
            &lt;depl.host&gt;&lt;!-- {shared instance IP} --&gt;&lt;/depl.host&gt;
            &lt;depl.port&gt;4502&lt;/depl.port&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;
</pre>
				</section>
			</section>

			<!-- BASIC EXAMPLE END-TO-END -->
			<section data-state="whiteout">
				<section>
					<h2>Putting it all together</h2>
					<img style="border: none" width="30%" src="images/puzzle.svg" alt="puzzle"/>
				</section>
				<section>
					<h2>0-60 in 5 pseudo lines</h2>
<pre class="fragment"><code>mvn archetype:generate</code></pre>
<pre class="fragment"><code>git init; git add *; git commit -m "Initial project"</code></pre>
<pre class="fragment"><code>mvn -PautoInstallPackage install</code></pre>
<pre class="fragment"><code>vlt checkout ; vlt update ; vlt commit</code>
<pre class="fragment"><code>git add; git commit; git push</code></pre>
				</section>
				<section>
					<img style="border: none" src="images/flow_default.png" alt="flow"/>
				</section>
				<section>
					<h2>Workflow</h2>
					<ul>
						<li>Project inception: generate with archetype</li>
						<li>Put in git</li>
						<li>Create components, templates with CRXDE Lite</li>
						<li>Use vlt to keep in sync with local filesystem</li>
						<li>Put in git</li>
						<li>Use local filesystem to develop java/osgi bundles etc</li>
						<li>Put in git</li>
						<li>Use maven to build and deploy to test environment</li>
						<li>Use a test framework to make sure it works (but see next slides)</li>
						<li>Use maven to deploy to production (but see next slides)</li>
					</ul>
				</section>
			</section>

			<section>
				<section>
					<h2>Where next?</h2>
				</section>
				<section>
					<h2>Integration Testing Framework</h2>
					<p>... see Lydia's talk</p>
				</section>
				<section>
					<h2>Deployment Testing</h2>
					<p>... see Bertrand's talk</p>
				</section>
			</section>
			<section data-state="sunset">
				<section>
					<img style="border: none" width="30%" src="images/question speech.svg" alt="questions?"/>
					<h3>Thank you. Questions?</h3>
				</section>
				<section>
					<h2>Credits</h2>

					<ul><small>
						<li><a href="http://thenounproject.com/noun/light-bulb/#icon-No7582" target="_blank">Light Bulb</a> designed by <a href="http://thenounproject.com/Shane_kenna" target="_blank">Shane David Kenna</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/question/#icon-No2185" target="_blank">Question</a> designed by <a href="http://thenounproject.com/anasr" target="_blank">Anas Ramadan</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/hard-disk-drive/#icon-No15295" target="_blank">Hard Disk Drive</a> designed by <a href="http://thenounproject.com/Eddieative" target="_blank">Eddie Alshehri</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/time/#icon-No7383" target="_blank">Time</a> designed by <a href="http://thenounproject.com/Wayne25uk" target="_blank">wayne25uk</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/sync/#icon-No2888" target="_blank">Sync</a> designed by <a href="http://thenounproject.com/somerandomdude" target="_blank">P.J. Onori</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/sync/#icon-No5857" target="_blank">Sync</a> designed by <a href="http://thenounproject.com/rohithdezinr" target="_blank">Rohith M S</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/cloud-upload/#icon-No2633" target="_blank">Cloud Upload</a> designed by <a href="http://thenounproject.com/adamwhitcroft" target="_blank">Adam Whitcroft</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/puzzle/#icon-No1201" target="_blank">Puzzle</a> designed by <a href="http://thenounproject.com/legologic" target="_blank">John O&#39;Shea</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/question/#icon-No2036" target="_blank">Question</a> designed by <a href="http://thenounproject.com/henryryder" target="_blank">Henry Ryder</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/factory/#icon-No819" target="_blank">Factory</a> designed by <a href="http://thenounproject.com/a2015" target="_blank">Adrijan Karavdic</a> from The Noun Project</li>
						<li><a href="http://thenounproject.com/noun/crash-test-dummy/#icon-No4954" target="_blank">Crash Test Dummy</a> designed by <a href="http://thenounproject.com/Luis" target="_blank">Luis Prado</a> from The Noun Project</li>
					</small></ul>
				</section>
			</section>
<!--
			<section data-markdown="talk.md" data-separator="^\n\n\n" data-vertical="^\n\n"></section>
-->
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>
			// Required, even if empty.
			Reveal.initialize({
				// Display controls in the bottom right corner
				controls: true,
				// Display a presentation progress bar
				progress: true,

				// Optional libraries used to extend on reveal.js
				dependencies: [
					// Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },

					// Interpret Markdown in <section> elements
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

					// Syntax highlight for <code> elements
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

					// Zoom in and out with Alt+click
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

					// Speaker notes
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

				]

			});

 
   function currentSlideNumber(event) {
    var formattedStr;
    if (event.indexh === 0) {
     return '';
    }
    formattedStr = event.indexh;
    if (event.indexv) {
     formattedStr += '/' + event.indexv;
    }
    return formattedStr;
   }
   // fires on slide change
   Reveal.addEventListener('slidechanged', function(event) {
    document.querySelector('.slide-number').innerText = currentSlideNumber(event);
   });
   //
   var slideNumberDiv = document.createElement('div');
   slideNumberDiv.classList.add('slide-number');
   document.querySelector('.controls').appendChild(slideNumberDiv);
  

		</script>
	</body>
</html>